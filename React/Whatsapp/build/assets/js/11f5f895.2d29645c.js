"use strict";(self.webpackChunkovrsea_whatsapp_tuto=self.webpackChunkovrsea_whatsapp_tuto||[]).push([[5521],{3905:(e,t,a)=>{a.d(t,{Zo:()=>h,kt:()=>u});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var i=n.createContext({}),p=function(e){var t=n.useContext(i),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},h=function(e){var t=p(e.components);return n.createElement(i.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,i=e.parentName,h=o(e,["components","mdxType","originalType","parentName"]),d=p(a),u=r,m=d["".concat(i,".").concat(u)]||d[u]||c[u]||s;return a?n.createElement(m,l(l({ref:t},h),{},{components:a})):n.createElement(m,l({ref:t},h))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,l=new Array(s);l[0]=d;var o={};for(var i in t)hasOwnProperty.call(t,i)&&(o[i]=t[i]);o.originalType=e,o.mdxType="string"==typeof e?e:r,l[1]=o;for(var p=2;p<s;p++)l[p]=a[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},4587:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>c,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var n=a(7462),r=(a(7294),a(3905));const s={sidebar_label:"Step 4: Transition to GraphQL",sidebar_position:4},l="Step 4: Transition to GraphQL",o={unversionedId:"tuto-whatsapp/step4",id:"version-1.0.0/tuto-whatsapp/step4",title:"Step 4: Transition to GraphQL",description:"[//]: # (head-end)",source:"@site/versioned_docs/version-1.0.0/tuto-whatsapp/step4.md",sourceDirName:"tuto-whatsapp",slug:"/tuto-whatsapp/step4",permalink:"/docs/1.0.0/tuto-whatsapp/step4",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/versioned_docs/version-1.0.0/tuto-whatsapp/step4.md",tags:[],version:"1.0.0",sidebarPosition:4,frontMatter:{sidebar_label:"Step 4: Transition to GraphQL",sidebar_position:4},sidebar:"tutorialSidebar",previous:{title:"Step 3: Setup a basic Node.JS server with a basic REST endpoint",permalink:"/docs/1.0.0/tuto-whatsapp/step3"},next:{title:"Step 5: Testing",permalink:"/docs/1.0.0/tuto-whatsapp/step5"}},i={},p=[{value:"<strong>Server</strong> Step 2.2: Create a basic GraphQL schema",id:"server-step-22-create-a-basic-graphql-schema",level:4},{value:"Added schema/typeDefs.graphql",id:"added-schematypedefsgraphql",level:5},{value:"Custom Scalars",id:"custom-scalars",level:3},{value:"<strong>Server</strong> Step 2.1: Setup Apollo GraphQL",id:"server-step-21-setup-apollo-graphql",level:4},{value:"Changed index.ts",id:"changed-indexts",level:5},{value:"<strong>Server</strong> Step 2.2: Create a basic GraphQL schema",id:"server-step-22-create-a-basic-graphql-schema-1",level:4},{value:"Added schema/typeDefs.graphql",id:"added-schematypedefsgraphql-1",level:5},{value:"<strong>Server</strong> Step 2.2: Create a basic GraphQL schema",id:"server-step-22-create-a-basic-graphql-schema-2",level:4},{value:"Added schema/resolvers.ts",id:"added-schemaresolversts",level:5},{value:"<strong>Server</strong> Step 2.2: Create a basic GraphQL schema",id:"server-step-22-create-a-basic-graphql-schema-3",level:4},{value:"Added schema/index.ts",id:"added-schemaindexts",level:5},{value:"<strong>Server</strong> Step 2.3: Resolve Chat.lastMessage",id:"server-step-23-resolve-chatlastmessage",level:4},{value:"Changed schema/resolvers.ts",id:"changed-schemaresolversts",level:5},{value:"<strong>Server</strong> Step 2.4: Remove GET /chats route",id:"server-step-24-remove-get-chats-route",level:4},{value:"Changed index.ts",id:"changed-indexts-1",level:5},{value:"<strong>Client</strong> Step 4.1: Replace REST call with GraphQL call",id:"client-step-41-replace-rest-call-with-graphql-call",level:4},{value:"Changed src/components/ChatsListScreen/ChatsList.tsx",id:"changed-srccomponentschatslistscreenchatslisttsx",level:5}],h={toc:p};function c(e){let{components:t,...s}=e;return(0,r.kt)("wrapper",(0,n.Z)({},h,s,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"step-4-transition-to-graphql"},"Step 4: Transition to GraphQL"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"What is GraphQL?")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"GraphQL Headline",src:a(535).Z,title:"GraphQL Headline",width:"2326",height:"554"})),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://graphql.org/"},"GraphQL")," is a query language invented by Facebook, and it's used to query data from a predefined schema."),(0,r.kt)("p",null,"The schema and query language can describe any data - a file, remote API, database, local storage or all of those combined."),(0,r.kt)("p",null,"In our case, we will create a schema for the data that our server exposes through its API.\nIt allows clients to define the structure of the data required, and the exact same structure of data will be returned from the server,\ntherefore preventing excessively large amounts of data from being returned."),(0,r.kt)("p",null,"Unlike REST, GraphQL APIs are organized in terms of types and fields, not endpoints."),(0,r.kt)("p",null,"Even if we use GraphQL without a server,\nit can save us a lot of code and work because it can transform data in a very easy way from a schema to a query."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"GraphQL Query Example",src:a(2494).Z,title:"GraphQL Query Example",width:"960",height:"720"})),(0,r.kt)("p",null,"Currently in our app, if we'd like to get its chats, we would send a GET request to ",(0,r.kt)("inlineCode",{parentName:"p"},"/chats"),".\nWith GraphQL, it would be done differently with a string that describes the data that we would like to get:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"chats {\n  id\n  name\n  picture\n  lastMessage {\n    id\n    content\n    createdAt\n  }\n}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"Above: An illustration of a potential GraphQL query sent to our Whatsapp API")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Why GraphQL and not REST?")),(0,r.kt)("p",null,"REST has been used for many years and has proven itself to work well, and it's completely agnostic to the implementation of the back-end.\nHowever, when it comes to data projection and aggregation, it fails to deliver."),(0,r.kt)("p",null,"When using REST, often times you'll find yourself performing multiple requests to execute a single query of data.\nNot only that, you might even end up with additional data that is not necessary.\nEither way, the process would result in slower and heavier response."),(0,r.kt)("p",null,"With GraphQL we don\u2019t have that kind of problem -"),(0,r.kt)("p",null,"GraphQL queries access not just the properties of one resource but also smoothly follow references between them.\nWhile typical REST APIs require loading from multiple URLs, GraphQL APIs get all the data your app needs in a single request.\nApps using GraphQL can be quick even on slow mobile network connections."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Multiple resource in a single request",src:a(5811).Z,title:"Multiple resource in a single request",width:"960",height:"880"})),(0,r.kt)("p",null,"In GraphQL, the API is based on a schema built from many entities that we call object types.\nThink of GraphQL as something similar to TypeScript but for API.\nObject types are like interfaces, they describe the shape of an entity."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Query to schema",src:a(7543).Z,title:"Query to schema",width:"952",height:"796"})),(0,r.kt)("p",null,"In TypeScript you would describe a Chat as:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"interface Chat {\n  id: string;\n  name: string;\n  picture: string;\n  lastMessage: Message;\n}\n\ninterface Message {\n  id: string;\n  content: string;\n  createdAt: number;\n}\n")),(0,r.kt)("p",null,"GraphQL:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"type Chat {\n  id: String\n  name: String\n  picture: String\n  lastMessage: Message\n}\n\ntype Message {\n  id: String\n  content: String\n  createdAt: Float\n}\n")),(0,r.kt)("p",null,"Looks pretty similar?"),(0,r.kt)("p",null,"So this is the definition of the available data, now let's see how we can pick and structure data from it using a query:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"# request\nchats {\n  id\n  name\n  picture\n  lastMessage {\n    id\n    content\n    createdAt\n  }\n}\n")),(0,r.kt)("p",null,"We think it\u2019s pretty straightforward to understand what you fetch by just looking at the query above."),(0,r.kt)("p",null,"If you would execute that query the result might look like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// response\n{\n  chats: [{\n    id: \u201c1\u201d,\n    name: \u201cEthan Gonzalez\u201d,\n    picture: \u201chttps://randomuser.me/api/portraits/thumb/men/1.jpg\u201d,\n    lastMessage: {\n      id: \u201c1\u201d,\n      content: "You on your way?",\n      createdAt: 1234567890\n  }]\n}\n')),(0,r.kt)("p",null,"GraphQL uses types to ensure Apps only ask for what\u2019s possible and provide clear and helpful errors."),(0,r.kt)("p",null,"You'll get exactly what you asked for with a single request. GraphQL provides a dynamic API while REST doesn't."),(0,r.kt)("p",null,"GraphQL also saves you a lot of manual code to write.\nWhen calling multiple REST endpoints in order to render a view, you need to:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Manually call multiple endpoints"),(0,r.kt)("li",{parentName:"ol"},"Write a code that orchestrates and waits for all the necessary calls to be completed in the most efficient way"),(0,r.kt)("li",{parentName:"ol"},"Combine all the results into a new merged structure of data that you can render")),(0,r.kt)("p",null,"GraphQL runtime is doing all of the above actions automatically for you, just by requiring you to define a schema and a query."),(0,r.kt)("p",null,"The static schemas and queries enable many more power features which we'll explore later on in the tutorial\nlike gradually evolving APIs, special data IDEs and more.."),(0,r.kt)("p",null,"One example, with schema introspection you know exactly what data you can request from your API without leaving your editor,\nhighlight potential issues before sending a query, and take advantage of improved code intelligence.\nHere is one example from ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/graphql/graphiql"},"GraphiQL")," for how GraphQL enable powerful tools from your API\u2019s type system:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"GraphiQL",src:a(3162).Z,title:"GraphiQL",width:"960",height:"390"})),(0,r.kt)("p",null,"Another example is ",(0,r.kt)("a",{parentName:"p",href:"https://graphql-inspector.com"},"GraphQL Inspector"),", which just by looking at your static schema and queries can help you prevent\nbreaking changes to your API."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"GraphQL schema, in a nutshell")),(0,r.kt)("p",null,"Like said earlier,  GraphQL APIs are organized in terms of types and fields.\nThat means that our app data should be described with a schema, where each field gonna have a resolver - the handler that will return the corresponding data.\nThings will be much clearer as we move further."),(0,r.kt)("p",null,"Let's try to describe our app's data with a GraphQL schema and then dive into it:"),(0,r.kt)("h4",{id:"server-step-22-create-a-basic-graphql-schema"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/Urigo/WhatsApp-Clone-Server/commit/1ca3ee7182451eb4120e7470a4c0946c3b3611c3"},(0,r.kt)("strong",{parentName:"a"},"Server")," Step 2.2: Create a basic GraphQL schema")),(0,r.kt)("h5",{id:"added-schematypedefsgraphql"},"Added schema","/","typeDefs.graphql"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -0,0 +1,19 @@\n+\u250a  \u250a 1\u250ascalar Date\n+\u250a  \u250a 2\u250ascalar URL\n+\u250a  \u250a 3\u250a\n+\u250a  \u250a 4\u250atype Message {\n+\u250a  \u250a 5\u250a  id: ID!\n+\u250a  \u250a 6\u250a  content: String!\n+\u250a  \u250a 7\u250a  createdAt: Date!\n+\u250a  \u250a 8\u250a}\n+\u250a  \u250a 9\u250a\n+\u250a  \u250a10\u250atype Chat {\n+\u250a  \u250a11\u250a  id: ID!\n+\u250a  \u250a12\u250a  name: String!\n+\u250a  \u250a13\u250a  picture: URL\n+\u250a  \u250a14\u250a  lastMessage: Message\n+\u250a  \u250a15\u250a}\n+\u250a  \u250a16\u250a\n+\u250a  \u250a17\u250atype Query {\n+\u250a  \u250a18\u250a  chats: [Chat!]!\n+\u250a  \u250a19\u250a}\n")),(0,r.kt)("p",null,"The schema is self explanatory in terms of what data it's compatible with."),(0,r.kt)("p",null,"To define a concrete data without any inner schema definition, scalars are used in GraphQL.\nFor example; ",(0,r.kt)("inlineCode",{parentName:"p"},"Int"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Float"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"Date"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"URL")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"EmailAddress"),"."),(0,r.kt)("p",null,"The supported built-in scalar types in GraphQL are mostly primitive types:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Int: Signed 32\u2010bit integer"),(0,r.kt)("li",{parentName:"ul"},"Float: Signed double-precision floating-point value"),(0,r.kt)("li",{parentName:"ul"},"String: UTF\u20108 character sequence"),(0,r.kt)("li",{parentName:"ul"},"Boolean: true or false"),(0,r.kt)("li",{parentName:"ul"},"ID (serialized as String): A unique identifier, often used to refetch an object or as the key for a cache.\nWhile serialized as a String, ID signifies that it is not intended to be human\u2010readable")),(0,r.kt)("h3",{id:"custom-scalars"},"Custom Scalars"),(0,r.kt)("p",null,"Any custom scalar can be declared with the ",(0,r.kt)("inlineCode",{parentName:"p"},"scalar")," keyword, and custom types can be declared with the ",(0,r.kt)("inlineCode",{parentName:"p"},"type")," keyword.\nScalars have their own internal validation, parsing and serialization logics."),(0,r.kt)("p",null,"For example, you can have a custom scalar type ",(0,r.kt)("inlineCode",{parentName:"p"},"DateTime"),".\nDue to JSON format restrictions, date objects are passed in string timestamp format or a number in milliseconds.\nInstead of having parsing, serialization, and validation logic in our business logic, we can define a ",(0,r.kt)("inlineCode",{parentName:"p"},"DateTime")," scalar and put everything on it.\nSo, we will have parsed native JavaScript ",(0,r.kt)("inlineCode",{parentName:"p"},"Date")," object in our business logic while it is transferred as string or number like before."),(0,r.kt)("p",null," ",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("em",{parentName:"strong"},(0,r.kt)("a",{parentName:"em",href:"https://medium.com/the-guild/graphql-scalars-1-0-is-out-more-types-data-integrity-and-strict-validations-on-graphql-972079428fb"},"You can read more about them in that blog post")))),(0,r.kt)("p",null,"However, you should know that some types are reserved by GraphQL itself; ",(0,r.kt)("inlineCode",{parentName:"p"},"Query")," is one of them.\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},"Query")," type will be used as the root for received queries by the clients, which means that we can send queries which start with the ",(0,r.kt)("inlineCode",{parentName:"p"},"chats")," field.\nOther reserved types are:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"type Query")," - reserved for ",(0,r.kt)("a",{parentName:"li",href:"https://graphql.org/learn/queries/#mutations"},"GraphQL queries"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"type Mutation")," - reserved for ",(0,r.kt)("a",{parentName:"li",href:"https://graphql.github.io/learn/queries/"},"GraphQL mutations.")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"type Subscription")," - reserved for ",(0,r.kt)("a",{parentName:"li",href:"https://www.apollographql.com/docs/react/advanced/subscriptions.html"},"GraphQL subscriptions."))),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"As we're not gonna go through the entire GraphQL API, it's recommended to go through the ",(0,r.kt)("a",{parentName:"p",href:"https://graphql.org/learn/"},"official learn section of the GraphQL website"),", but the information so far will definitely help you kick-start, plus the upcoming implementation.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Getting started")),(0,r.kt)("p",null,"We will be implementing a GraphQL mechanism for the client and for the server.\nWe will start with the server as things will make more sense, and we will be able to test it before we proceed into the client.\nEssentially GraphQL is connected into an HTTP endpoint, usually under ",(0,r.kt)("inlineCode",{parentName:"p"},"POST /graphql"),", and so this is exactly what we're gonna do, connect the endpoint handler.\nLuckily, we don't have to implement that. A team called ",(0,r.kt)("a",{parentName:"p",href:"https://www.apollographql.com/"},"Apollo")," already did it for us so that we can use their implementation.\nWe will install the required packages:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ yarn add apollo-server-express@2.13.1 graphql@15.0.0\n$ yarn add --dev @types/graphql@14.5.0\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/graphql"},(0,r.kt)("inlineCode",{parentName:"a"},"graphql"))," - The core package of GraphQL that includes the resolvers for basic data-types."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/apollo-server-express"},(0,r.kt)("inlineCode",{parentName:"a"},"apollo-server-express"))," - Apollo's implementation for the GraphQL Express REST endpoint."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"@types/graphql")," - TypeScript definitions. Notice that we didn't need to install Apollo's types library. That is because Apollo themselves writes their source code in Typescript so\nwe get a ready Typescript code directly from their library.")),(0,r.kt)("p",null,"We can now connect Apollo's middleware under the ",(0,r.kt)("inlineCode",{parentName:"p"},"/graphql")," route:"),(0,r.kt)("h4",{id:"server-step-21-setup-apollo-graphql"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/Urigo/WhatsApp-Clone-Server/commit/d90eb3ae0a13597af8de85f0afa30df7511bf29d"},(0,r.kt)("strong",{parentName:"a"},"Server")," Step 2.1: Setup Apollo GraphQL")),(0,r.kt)("h5",{id:"changed-indexts"},"Changed index.ts"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -1,10 +1,13 @@\n+\u250a  \u250a 1\u250aimport { ApolloServer, gql } from 'apollo-server-express';\n \u250a 1\u250a 2\u250aimport cors from 'cors';\n \u250a 2\u250a 3\u250aimport express from 'express';\n \u250a 3\u250a 4\u250aimport { chats } from './db';\n+\u250a  \u250a 5\u250aimport schema from './schema';\n \u250a 4\u250a 6\u250a\n \u250a 5\u250a 7\u250aconst app = express();\n \u250a 6\u250a 8\u250a\n \u250a 7\u250a 9\u250aapp.use(cors());\n+\u250a  \u250a10\u250aapp.use(express.json());\n \u250a 8\u250a11\u250a\n \u250a 9\u250a12\u250aapp.get('/_ping', (req, res) => {\n \u250a10\u250a13\u250a  res.send('pong');\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -14,6 +17,13 @@\n \u250a14\u250a17\u250a  res.json(chats);\n \u250a15\u250a18\u250a});\n \u250a16\u250a19\u250a\n+\u250a  \u250a20\u250aconst server = new ApolloServer({ schema });\n+\u250a  \u250a21\u250a\n+\u250a  \u250a22\u250aserver.applyMiddleware({\n+\u250a  \u250a23\u250a  app,\n+\u250a  \u250a24\u250a  path: '/graphql',\n+\u250a  \u250a25\u250a});\n+\u250a  \u250a26\u250a\n \u250a17\u250a27\u250aconst port = process.env.PORT || 4000;\n \u250a18\u250a28\u250a\n \u250a19\u250a29\u250aapp.listen(port, () => {\n")),(0,r.kt)("p",null,"As you can see, the middleware requires a schema. A schema is composed mainly out of 2 fields:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"typeDefs")," (type definitions) - the schema types we wrote earlier this chapter for chats."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"resolvers")," - Functions that will provide the data for each field in ",(0,r.kt)("inlineCode",{parentName:"li"},"typeDefs"),".")),(0,r.kt)("p",null,"You can think about our resolver functions as boxes on the shelf which we prepare for later, when GraphQL will execute them\nand for the schema as the label that describe those functions:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Resolvers and schemas",src:a(9966).Z,title:"Resolvers and schemas",width:"800",height:"450"})),(0,r.kt)("p",null,"We will start first by defining the types.\nAll we have to do is to copy-paste the contents of the schema that was shown earlier into a new file called ",(0,r.kt)("inlineCode",{parentName:"p"},"typeDefs.graphql"),":"),(0,r.kt)("h4",{id:"server-step-22-create-a-basic-graphql-schema-1"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/Urigo/WhatsApp-Clone-Server/commit/1ca3ee7182451eb4120e7470a4c0946c3b3611c3"},(0,r.kt)("strong",{parentName:"a"},"Server")," Step 2.2: Create a basic GraphQL schema")),(0,r.kt)("h5",{id:"added-schematypedefsgraphql-1"},"Added schema","/","typeDefs.graphql"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -0,0 +1,19 @@\n+\u250a  \u250a 1\u250ascalar Date\n+\u250a  \u250a 2\u250ascalar URL\n+\u250a  \u250a 3\u250a\n+\u250a  \u250a 4\u250atype Message {\n+\u250a  \u250a 5\u250a  id: ID!\n+\u250a  \u250a 6\u250a  content: String!\n+\u250a  \u250a 7\u250a  createdAt: Date!\n+\u250a  \u250a 8\u250a}\n+\u250a  \u250a 9\u250a\n+\u250a  \u250a10\u250atype Chat {\n+\u250a  \u250a11\u250a  id: ID!\n+\u250a  \u250a12\u250a  name: String!\n+\u250a  \u250a13\u250a  picture: URL\n+\u250a  \u250a14\u250a  lastMessage: Message\n+\u250a  \u250a15\u250a}\n+\u250a  \u250a16\u250a\n+\u250a  \u250a17\u250atype Query {\n+\u250a  \u250a18\u250a  chats: [Chat!]!\n+\u250a  \u250a19\u250a}\n")),(0,r.kt)("blockquote",null,(0,r.kt)("p",{parentName:"blockquote"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},".graphql")," file extension is just a more convenient way to work with a GraphQL schema.\nThe exported result should be a simple string that we can use to compose our GraphQL schema.\nThe clear advantage of working with a dedicated file is that we get to have syntax highlight.")),(0,r.kt)("p",null,"Note that some of the fields have exclamation mark at the end and it means that the field is non-nullable,\nmeaning that the GraphQL service promises to always give you a value when you query this field."),(0,r.kt)("p",null,"Chats Query is even more interesting case with two exclamation marks ",(0,r.kt)("inlineCode",{parentName:"p"},"[Chat!]!"),"."),(0,r.kt)("p",null,"The outer exclamation mark means that if you run this query it will always return an array of zero or more items (never null)\nand inner exclamation mark means that every item of returned array will be of type ",(0,r.kt)("inlineCode",{parentName:"p"},"Chat")," and never be null."),(0,r.kt)("p",null,"Now we will implement the resolvers. Resolvers functions, presented in a JSON object, that correspond to each field in the GraphQL schema.\nEach resolver name should match the field name it represents.\nIt will accept as a parameter the parent resolver value (we'll explain that process in a second),\ncan run any logic, like calling a server, and returns a value that correspond to the type it has in the schema:"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Resolver",src:a(498).Z,title:"Resolver",width:"800",height:"450"})),(0,r.kt)("p",null,"You can read more about resolvers in ",(0,r.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/tutorial/resolvers.html"},"Apollo's official docs for resolvers"),"."),(0,r.kt)("p",null,"This is how our resolvers should look like:"),(0,r.kt)("h4",{id:"server-step-22-create-a-basic-graphql-schema-2"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/Urigo/WhatsApp-Clone-Server/commit/1ca3ee7182451eb4120e7470a4c0946c3b3611c3"},(0,r.kt)("strong",{parentName:"a"},"Server")," Step 2.2: Create a basic GraphQL schema")),(0,r.kt)("h5",{id:"added-schemaresolversts"},"Added schema","/","resolvers.ts"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -0,0 +1,15 @@\n+\u250a  \u250a 1\u250aimport { DateTimeResolver, URLResolver } from 'graphql-scalars';\n+\u250a  \u250a 2\u250aimport { chats } from '../db';\n+\u250a  \u250a 3\u250a\n+\u250a  \u250a 4\u250aconst resolvers = {\n+\u250a  \u250a 5\u250a  Date: DateTimeResolver,\n+\u250a  \u250a 6\u250a  URL: URLResolver,\n+\u250a  \u250a 7\u250a\n+\u250a  \u250a 8\u250a  Query: {\n+\u250a  \u250a 9\u250a    chats() {\n+\u250a  \u250a10\u250a      return chats;\n+\u250a  \u250a11\u250a    },\n+\u250a  \u250a12\u250a  },\n+\u250a  \u250a13\u250a};\n+\u250a  \u250a14\u250a\n+\u250a  \u250a15\u250aexport default resolvers;\n")),(0,r.kt)("p",null,"For now it's extremely simple, we map the chats query directly into the database collection.\nEach field in the resolvers object should match the GraphQL type it represents in the schema, But in our case, we've just implemented ",(0,r.kt)("inlineCode",{parentName:"p"},"chats"),"."),(0,r.kt)("p",null,"That's because the GraphQL engine we are using (graphql.js), knows how to understand json structure and our chats object is already structured like our schema."),(0,r.kt)("p",null,"Later on we'll add resolvers of more fields because we'll need more logic the get the right response."),(0,r.kt)("p",null,"Note that we've implemented a custom scalar named ",(0,r.kt)("inlineCode",{parentName:"p"},"Date")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"URL")," but we will need an implementation for it.\nWe will use ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/urigo/graphql-scalars"},(0,r.kt)("inlineCode",{parentName:"a"},"graphql-scalars"))," that has many custom scalars ready-to-use."),(0,r.kt)("p",null,"Let's install it:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ yarn add graphql-scalars\n")),(0,r.kt)("p",null,"Final thing that we have to do would be combining the resolvers and the type-defs under a single GraphQL schema."),(0,r.kt)("h4",{id:"server-step-22-create-a-basic-graphql-schema-3"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/Urigo/WhatsApp-Clone-Server/commit/1ca3ee7182451eb4120e7470a4c0946c3b3611c3"},(0,r.kt)("strong",{parentName:"a"},"Server")," Step 2.2: Create a basic GraphQL schema")),(0,r.kt)("h5",{id:"added-schemaindexts"},"Added schema","/","index.ts"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -0,0 +1,7 @@\n+\u250a \u250a1\u250aimport { importSchema } from 'graphql-import';\n+\u250a \u250a2\u250aimport { makeExecutableSchema } from 'graphql-tools';\n+\u250a \u250a3\u250aimport resolvers from './resolvers';\n+\u250a \u250a4\u250a\n+\u250a \u250a5\u250aconst typeDefs = importSchema('schema/typeDefs.graphql');\n+\u250a \u250a6\u250a\n+\u250a \u250a7\u250aexport default makeExecutableSchema({ resolvers, typeDefs });\n")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/graphql-tools"},(0,r.kt)("inlineCode",{parentName:"a"},"graphql-tools"))," is a library with a set of utilities that will help us create a schema that will be compatible with Apollo's API:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"$ yarn add graphql-tools graphql-import\n")),(0,r.kt)("p",null,"There's one optimization however, that we should make in our DB.\nRight now, each chat document has a direct reference to a message via the ",(0,r.kt)("inlineCode",{parentName:"p"},"lastMessage")," field.\nPractically speaking, this is NOT how the data sits in the DB.\nThe ",(0,r.kt)("inlineCode",{parentName:"p"},"lastMessage")," should only holds the ID for the correlated message, and then in the Node.JS app,\nwe should ",(0,r.kt)("strong",{parentName:"p"},"resolve")," it according to our needs. Let's make the appropriate changes in the resolver of the ",(0,r.kt)("inlineCode",{parentName:"p"},"lastMessage")," field:"),(0,r.kt)("h4",{id:"server-step-23-resolve-chatlastmessage"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/Urigo/WhatsApp-Clone-Server/commit/5dc433685eded0898bff4b1d7d2cc8f452c7b135"},(0,r.kt)("strong",{parentName:"a"},"Server")," Step 2.3: Resolve Chat.lastMessage")),(0,r.kt)("h5",{id:"changed-schemaresolversts"},"Changed schema","/","resolvers.ts"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -1,10 +1,16 @@\n \u250a 1\u250a 1\u250aimport { DateTimeResolver, URLResolver } from 'graphql-scalars';\n-\u250a 2\u250a  \u250aimport { chats } from '../db';\n+\u250a  \u250a 2\u250aimport { chats, messages } from '../db';\n \u250a 3\u250a 3\u250a\n \u250a 4\u250a 4\u250aconst resolvers = {\n \u250a 5\u250a 5\u250a  Date: DateTimeResolver,\n \u250a 6\u250a 6\u250a  URL: URLResolver,\n \u250a 7\u250a 7\u250a\n+\u250a  \u250a 8\u250a  Chat: {\n+\u250a  \u250a 9\u250a    lastMessage(chat: any) {\n+\u250a  \u250a10\u250a      return messages.find((m) => m.id === chat.lastMessage);\n+\u250a  \u250a11\u250a    },\n+\u250a  \u250a12\u250a  },\n+\u250a  \u250a13\u250a\n \u250a 8\u250a14\u250a  Query: {\n \u250a 9\u250a15\u250a    chats() {\n \u250a10\u250a16\u250a      return chats;\n")),(0,r.kt)("p",null,"The first argument of the resolver is the raw chat data received by the parent of that resolver field (",(0,r.kt)("inlineCode",{parentName:"p"},"chats")," resolver),\nand the returned result should be the mapped value which we would like to return to the client."),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"GraphQL Execution Process",src:a(1905).Z,title:"GraphQL Execution Process",width:"600",height:"338"})),(0,r.kt)("p",null,"In our case, the ",(0,r.kt)("inlineCode",{parentName:"p"},"lastMessage")," resolver would be executed by the GraphQL engine with the return value of the ",(0,r.kt)("inlineCode",{parentName:"p"},"chats")," resolver."),(0,r.kt)("p",null,"As we get further in this tutorial we should get a better grasp regards resolvers and their API, since we will have to deal with more logic and complexity within our Node.JS app."),(0,r.kt)("p",null,"Assuming that the server is running, we can already test our GraphQL endpoint.\nBecause it's exposed to us via a REST endpoint, we can use a ",(0,r.kt)("inlineCode",{parentName:"p"},"$ curl")," command to send a request to ",(0,r.kt)("inlineCode",{parentName:"p"},"GET localhost:4000/graphql")," and get a response with all the data.\nAgain, the query that we're gonna use to fetch the chats is:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-graphql"},"chats {\n  id\n  name\n  picture\n  lastMessage {\n    id\n    content\n    createdAt\n  }\n}\n")),(0,r.kt)("p",null,"The one-liner version of it with a ",(0,r.kt)("inlineCode",{parentName:"p"},"$ curl")," command looks like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},'curl \\\n  -X POST \\\n  -H "Content-Type: application/json" \\\n  --data \'{ "query": "{ chats { id name picture lastMessage { id content createdAt } } }" }\' \\\n  localhost:4000/graphql\n')),(0,r.kt)("p",null,"As a response we should get the data-mock for our chats stored in the server. Since we have that in place, we can go ahead and delete our implementation for the ",(0,r.kt)("inlineCode",{parentName:"p"},"GET /chats")," route."),(0,r.kt)("h4",{id:"server-step-24-remove-get-chats-route"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/Urigo/WhatsApp-Clone-Server/commit/000839bbf99e44a8c3c838e8a6e1fd7c43efa273"},(0,r.kt)("strong",{parentName:"a"},"Server")," Step 2.4: Remove GET /chats route")),(0,r.kt)("h5",{id:"changed-indexts-1"},"Changed index.ts"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -1,7 +1,6 @@\n \u250a1\u250a1\u250aimport { ApolloServer, gql } from 'apollo-server-express';\n \u250a2\u250a2\u250aimport cors from 'cors';\n \u250a3\u250a3\u250aimport express from 'express';\n-\u250a4\u250a \u250aimport { chats } from './db';\n \u250a5\u250a4\u250aimport schema from './schema';\n \u250a6\u250a5\u250a\n \u250a7\u250a6\u250aconst app = express();\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -13,10 +12,6 @@\n \u250a13\u250a12\u250a  res.send('pong');\n \u250a14\u250a13\u250a});\n \u250a15\u250a14\u250a\n-\u250a16\u250a  \u250aapp.get('/chats', (req, res) => {\n-\u250a17\u250a  \u250a  res.json(chats);\n-\u250a18\u250a  \u250a});\n-\u250a19\u250a  \u250a\n \u250a20\u250a15\u250aconst server = new ApolloServer({ schema });\n \u250a21\u250a16\u250a\n \u250a22\u250a17\u250aserver.applyMiddleware({\n")),(0,r.kt)("p",null,"Another way to test and inspect our GraphQL schema would be by using an IDE for the browser called ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/prisma/graphql-playground"},"GraphQL Playground"),".\nApollo-Server ships with it right out of the box and can be used right away by navigating to the ",(0,r.kt)("inlineCode",{parentName:"p"},"http://localhost:4000/graphql")," URL from the browser."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://graphqlbin.com/v2/6RQ6TM"},(0,r.kt)("img",{parentName:"a",src:"https://i.imgur.com/AE5W6OW.png",alt:null}))),(0,r.kt)("p",null,"So getting back to the client, all we have to do is to change the fetching URL in the ChatsList component to use our newly implemented GraphQL REST endpoint:"),(0,r.kt)("h4",{id:"client-step-41-replace-rest-call-with-graphql-call"},(0,r.kt)("a",{parentName:"h4",href:"https://github.com/Urigo/WhatsApp-Clone-Client-React/commit/ad5a988577e40e0ee5debd87783b0623645cc817"},(0,r.kt)("strong",{parentName:"a"},"Client")," Step 4.1: Replace REST call with GraphQL call")),(0,r.kt)("h5",{id:"changed-srccomponentschatslistscreenchatslisttsx"},"Changed src","/","components","/","ChatsListScreen","/","ChatsList.tsx"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-diff"},"@@ -56,12 +56,35 @@\n \u250a56\u250a56\u250a  font-size: 13px;\n \u250a57\u250a57\u250a`;\n \u250a58\u250a58\u250a\n+\u250a  \u250a59\u250aconst getChatsQuery = `\n+\u250a  \u250a60\u250a  query GetChats {\n+\u250a  \u250a61\u250a    chats {\n+\u250a  \u250a62\u250a      id\n+\u250a  \u250a63\u250a      name\n+\u250a  \u250a64\u250a      picture\n+\u250a  \u250a65\u250a      lastMessage {\n+\u250a  \u250a66\u250a        id\n+\u250a  \u250a67\u250a        content\n+\u250a  \u250a68\u250a        createdAt\n+\u250a  \u250a69\u250a      }\n+\u250a  \u250a70\u250a    }\n+\u250a  \u250a71\u250a  }\n+\u250a  \u250a72\u250a`;\n+\u250a  \u250a73\u250a\n \u250a59\u250a74\u250aconst ChatsList = () => {\n \u250a60\u250a75\u250a  const [chats, setChats] = useState<any[]>([]);\n \u250a61\u250a76\u250a\n \u250a62\u250a77\u250a  useMemo(async () => {\n-\u250a63\u250a  \u250a    const body = await fetch(`${process.env.REACT_APP_SERVER_URL}/chats`);\n-\u250a64\u250a  \u250a    const chats = await body.json();\n+\u250a  \u250a78\u250a    const body = await fetch(`${process.env.REACT_APP_SERVER_URL}/graphql`, {\n+\u250a  \u250a79\u250a      method: 'POST',\n+\u250a  \u250a80\u250a      headers: {\n+\u250a  \u250a81\u250a        'Content-Type': 'application/json',\n+\u250a  \u250a82\u250a      },\n+\u250a  \u250a83\u250a      body: JSON.stringify({ query: getChatsQuery }),\n+\u250a  \u250a84\u250a    });\n+\u250a  \u250a85\u250a    const {\n+\u250a  \u250a86\u250a      data: { chats },\n+\u250a  \u250a87\u250a    } = await body.json();\n \u250a65\u250a88\u250a    setChats(chats);\n \u250a66\u250a89\u250a  }, []);\n")),(0,r.kt)("p",null,"The received data should be similar to the previous one.\nNo further changes are required."),(0,r.kt)("p",null,"In the next chapter, we will learn how to test the React.Components in the client, and Apollo-GraphQL resolvers in the server."),(0,r.kt)("hr",null),(0,r.kt)("p",null,"TODO: Start with calling the  ",(0,r.kt)("inlineCode",{parentName:"p"},"graphql")," function just on the server to show how it works.\nTODO: Example middlewares in Node\nTODO: Mention the vs code extension"),(0,r.kt)("p",null,"TODO: Start without Apollo and add it later, in the same file."),(0,r.kt)("p",null,"TODO: Why adding headers? and go through the code"),(0,r.kt)("p",null,"TODO: Talk about working with document node and not with makeExacutableSchema"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u05d6\u05d4 \u05dc\u05d0 \u05de\u05e9\u05e0\u05d4 \u05d1\u05ea\u05db\u05dc\u05e1, \u05db\u05d9 ApolloServer \u05d1\u05db\u05dc \u05de\u05e7\u05e8\u05d4 \u05d9\u05e2\u05e9\u05d4 \u05dc\u05d6\u05d4 \u05e7\u05d9\u05de\u05e4\u05d5\u05dc\n\u05d4\u05e0\u05e7\u05d5\u05d3\u05d4 \u05d4\u05d9\u05d0 \u05e9\u05dc\u05d0 \u05e6\u05e8\u05d9\u05da \u05dc\u05e7\u05de\u05e4\u05dc \u05e4\u05e2\u05de\u05d9\u05d9\u05dd \u05dcGraphQLSchema\n\u05e4\u05e9\u05d5\u05d8 \u05e2\u05d3\u05d9\u05e3 \u05e9\u05d0\u05ea \u05d4\u05e7\u05d9\u05de\u05e4\u05d5\u05dc \u05d9\u05e2\u05e9\u05d4 \u05d4\u05e8\u05db\u05d9\u05d1 \u05d4\u05d0\u05d7\u05e8\u05d5\u05df \u05e9\u05d4\u05d5\u05dc\u05da \u05dc\u05d4\u05e9\u05ea\u05de\u05e9 \u05d1typeDefs\n\nDocumentNode => DocumentNode (cheap, easy, no checks)\nDocumentNode => GraphQLSchema (compile AST, does all checking, might throw exceptions, expensive)\nGraphQLSchema => DocumentNode (printed version, might lost AST features such as directives)\n")),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:"left"},(0,r.kt)("a",{parentName:"th",href:"https://github.com/Urigo/WhatsApp-Clone-Tutorial/tree/master@next/.tortilla/manuals/views/step3.md"},"< Previous Step")),(0,r.kt)("th",{parentName:"tr",align:"right"},(0,r.kt)("a",{parentName:"th",href:"https://github.com/Urigo/WhatsApp-Clone-Tutorial/tree/master@next/.tortilla/manuals/views/step5.md"},"Next Step >"))))))}c.isMDXComponent=!0},3162:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/graphiql-af02210c7a75113f2c8c11b51611495b.gif"},535:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/graphql-headline-11406b7f6e83c13d773d205c2c174dae.png"},2494:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/graphql-query-example-914a34d9352a8c8120658b8fdf86e770.gif"},1905:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/graphql-resolver-process-f856bd2fccdba047a797a6696818d062.gif"},5811:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/multiple-resource-single-request-e3707c736a6795b35c11a7484b04bdbf.gif"},7543:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/query-to-schema-9b832d51691c35da72cee2e6158195e7.gif"},498:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/resolver-57054a4930fd4c6fc0bbf4559c502fc8.gif"},9966:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/resolvers-and-schemas-133cd90059c7ea253ee44a5922380bbc.gif"}}]);